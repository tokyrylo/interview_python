# Як працює ООП

Коли інтерпритатор зустрічає оголошення класу (`class MyClass:`), він виконує:

 - **Обробку метакласу** (`__new__` метакласу).
 - **Створення класу**.
 - **Визначень атрібутов та методів**.

***Магічні методи***:

 - `Meta.__new__(cls, name, bases, dct)` - створює клас через метаклас
 - `Meta.__init__(cls, name, bases, dct)` - ініціалізує клас.
 - `__prepare__(name, bases)` - використовується перед `__new__` у метакласах 

```python

class Meta(cls):
  def __new__(cls, name, bases, dct):
    print(f"Метаклас створює {name}")
    return super().__new__(cls, name, bases, dct)


class MyClass(metaclass=Meta):
  class_attr = "Класовий атрибут"
```

**В цей момент**:
1. Спочатку запускається `__new__` метакласу 
2. Потім запускається `__init__` метакласу
3. Клас стає доступним для створення об'єкту 

***Створення екземпляру класу***
Коли ми створюємо об'єкт (`obj = MyClass()`). Python виконує:

- Виклик `__new__` - створення нового об'єкту.
- Виклик `__init__` - ініціалізація атрибутів об'єкту

**Магічні методи**
- `__new__(cls, *args, **kwargs)` - створює екземпляр 
- `__init__(self, *args, **kwargs)` - ініціалізує екземпляр 

```python 
class MyClass:
  def __new__(cls, *args, **kwargs):
    print("__new__ створює об'єкт")
    instance = super().__new__(cls)
    return instance 

  def __init__(self, value):
    print("__init__ ініціалізує об'єкт")
    self.value = value

obj = MyClass(10)
```

**Результат:**

```bash 
__new__ створює об'єкт 
__init__ ініціалізує об'єкт 
```

**Що відбувається**:

1. `__new__` створює пам'ять об'єкту 
2. `__init__` виконується після ініціалізації об'єкту 

***Створення атрибутів класу та екземпляру***

**Атрибути класу** створюються під час оголошення класу. 
**Атрибути екземпляру** створюються в `__init__` або `__setattr__`.

**Магічні методи**:

- `__setattr__(self, name, value)` - встановлює значення атрибута.
- `__getattr__(self, name)` - отримує атрибут (якщо його немає).
- `__delattr__(self, name)` - видаляє атрибут.

```python 
class Demo:
  class_attr = "Класовий атрибут" # створюється під час оголошення класу 

  def __init__(self, value):
    self.instance_attr = value # створюється при виклику __init__

obj = Demo("Екземплярний атрибут")
print(Demo.class_attr) # "Класовий атрибут"
print(obj.instance_attr) # "Екземплярний атрибут"
```

***Виклик об'єкта як функції***

Якщо ми хочемо зробити екземпляр класу викликаємим (`obj()`), використовуємо `__call__`.

**Магічний метод:**
- `__call__(self, *args, **kwargs)` - дозволяє об'єкту працювати як функція

```python 
class CallableClass:
  def __call__(self, name):
    print(f"Виклик об'єкту як функція: Привіт, {name}")

obj = CallableClass()
obj("Світ") # "Виклик об'єкта як функція: Привіт, Світ!"
```
***Створення та знищення об'єкту***:
При видаленні об'єкта викликається `__del__`.

**Магічний метод:**
- `__del__(self)` - викликається при видалені об'єкта 

```python 
class Demo:
  def __del__(self):
    print("Об'єкт видаляється")

obj = Demo()
del obj # "Об'єкт видаляється"
```
***Підсумковий порядок виконання магічних методів***


| Етап | Магічний метод | Опис |
| --------------- | --------------- | --------------- |
| 1. Створення класу | `Meta.__new__` | Створює клас (якщо є метаклас) |
|  | `Meta.__init__` | Ініціалізує клас |
| 2. Оголошення класових атрибутів | -- | Визначаються під час оголошення класу |
| 3. Створення об'єкта | `__new__` | Створює новий екземпляр |
|  | `__init__` | Ініціалізує екземпляр |
| 4. Доступ до атрибутів | `__getattr__`, `__setattr__`, `__delattr__` | Отримання, встановлення, видалення атрибутів |
| 5. Виклик як функція | `__call__` | Робить об'єкт викликаємим |
| 6. Виделення об'єкту| `__del__` | Видаляє екземпляр |

***Висновок***

1. **Метаклас створює клас**, а не об'єкт.
2. `__new__` **створює об'єкт**, а `__init__` його ініціалізує.
3. **Атрибути класу ініціалізуються під час оголошення класу**, а екземляра - в `__init__`.
4. **Об'єкти автоматично видаляються збирачем сміття**, але можна перевизначити `__del__`.
