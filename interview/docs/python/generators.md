# Генератори

Генератор - це **функція або вираз**, який **повертає послідовність значень**, але **не обчислює їх одразу**. Замість `return`, вони використовують ключове слово `yield`.

## Синтаксис генератора

1. **Генератор функція**:

```python
def my_generator():
    yield 1
    yield 2
    yield 3
    yield 4

gen = my_generator()
for value in gen:
    print(value)
```

2. **Генератор вираз (аналог list comprehension)**:
```python
gen = (x * x for x in range(4))
```

## Як працює генератор під капотом?

1. **Виклика генератора-функції** НЕ запускає її код. Він створює **об'єкт-генератор** (iterator).
2. Коли ти викликаєш `next()` або входиш у цикл `for`, виконується **наступний фрагмент коду до** `yield`.
3. Після `yield` генератор "**заморожується**" - тобто **зберігає стан (локальні змінні, позицію)**.
4. При наступному `next()` виконання поновлюється з **того місця**, де зупинилося.

## Поведінка з пам'ятью
Головна перевага - **генератори споживають набагато меньше пам'яті**, ніж, наприклад, списки.

```python
# Погано: створює одразу 10**6 об'єктів
squares = [x*x for x in range(10**6)]

# Добре: створює по одному значенню при потребі
squares = (x*x for x in range(10**6))
```
**Чому?**
 - Генератор **не зберігає всі значення в пам'яті**.
 - Він **зберігає лише стан**: поточну позицію, локальні змінні, і вказник на функцію.
 - Один генератор може займати **всього декілька сотен байтів**, незалежно від розміру послідовності, яку він генерує.

## Як інтерпретується в CPython?

 - Генератор компілюється у спеціальний код об'єкта генератора.
 - Його внутрішня реалізація базується на корутинах (після Python 3.5 – через async def).
 - У CPython, генератор — це структура PyGenObject, яка містить:
    - gi_frame: фрейм виконання
    - gi_code: байт-код функції
    - gi_running: прапорець стану

Іншими словами, це майже як зупинена функція, яка "запам’ятала", де вона була.

## Підводні камені

1. **Однаразовість**: Генератори **не можна перезапускати**.
```python
gen = my_generator()

list(gen)
list(gen) # Порожній
```
2. **Трейсбеки важчі для дебагу** - особливо якщо ти не очікуєш "відкладеного виконання".
3. **Не підходять, коли потрібен випадковий доступ**(на кшталт списків).

## Переваги генераторів
 - Менше пам’яті
 - Простота написання
 - Підходить для роботи зі стрімами, файлами, великими об’ємами даних
 - Чудово поєднуються з for, map, zip, any, all