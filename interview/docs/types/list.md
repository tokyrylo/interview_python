# List 

***Що таке список (list)***

***List*** у Python - це **змінюваний (mutable), впорядкований** тип даних, який зберігає послідовність елементів. Елементи списку можуть бути будь-якого типу (навіть інші списки), і вони можуть змінюватися після створення списку.

Приклад:

```python 
my_list = [1, "hello", 3.14, [1, 2, 3]]
```

***Як список працює "під капотом"?***

**1. Внутрішня організація**

Список у Python реалізоний як **динамічний масив посилань на об'єкти**. Це означає:

  - Список зберігає **посилання (refferences)** на об'єкти, а не самі об'єкти.
  - Елементи списку можуть бути різних типів, оскільки Python зберігає лише посилання на них.
  - Список динамічно змінює свій розмір при додаванні або видаленні об'єктів.

**2. Використання пам'яті**

  - **Посилання на об'єкти**: Список зберігає вказівники (посилання) на об'єкти в пам'яті. Наприклад, якщо у вас є список `[1, "hello", 3.14]`, то в пам'яті зберігаються посилання на цілі числа, рядки та числа з плаваючою точкою.
  - **Динамічний масив**: Список виділяє пам'ять у вигляді масиву фіксованого розміру, але якщо цього розміру стає недостатньо, Python автоматично виділяє новий, більший блок пам'яті та копією туди старі елементи. Це називається **resizing**.
  - **Over-allocating**: Python часто виділяє більше пам'яті, ніж потрібно, щоб уникнути частих операцій копіювання при додаванні нових елементів. Наприклад, якщо ви додаєте один елемент до списку. Python може виділити пам'ять для кількох додаткових елементів заздалегіть.

***3. Операції зі списками та їх складність***

Ось основні операції зі списками та їх частова складність (Big-O):

| Операція | Складність | Опис |
| --------------- | --------------- | --------------- |
| Доступ за індексом `lst[i]` | O(1) | Швидкість доступу до елемента за індексом. |
| Додавання в кінець `append` | O(1) | Додавання елемента в кінець списку. |
| Вставка (`insert`) | O(n) | Вставка елемента в середину списку потребує зсуву всіх наступних елементів. |
| Видалення (`pop(i)`) | O(n) | Видалення елемента з середину списку потребує зсуву всіх наступних елементів. |
| Пошук (`x in lst`) | O(n) | Пошук елемента в списку потребує перебору всіх елементів. |
| Зріз (`lst[a:b]`) | O(k) | Створення нового списку з елементів від `a` до `b` |
| Конкатенація (`lst1 + lst2`) | O(n+m) | Створення нового списку шляхом об'єднання двох списків |

***4. Динамічне змінення розміру (Resizing)***

Коли список заповнюється, Python автоматично збільшує його розмір. Це відбувається за таким алгоритмом:

  1. Виділяється новий, більший блок пам'яті.
  2. Елементи зі старого списку копіюються в новий блок.
  3. Старий блок пам'яті звільняється.

Зазвичай Python збільшує розмір списку в **1.125-1.5 рази** від поточного розміру, щоб уникнути занадто частих операцій копіювання.

***5. Приклад роботи з пам'яттю***

Розглянемо приклад:

```python 
lst = [] # Створюється пустий список 
for i in range(10):
  lst.append(i) # Додаємо елементи 
```

  - Спочатку список виділяє пам'ять для кількох елементів (наприклад, 4).
  - Коли місця більше не має, Python виділяє новий блок пам'яті (наприклад, на 8 лементів) і копіює туди старі елементи.
  - Цей процес повторюється, коли список знову заповнюється.

***6. Переваги списків***

  - **Гнучкість**: Можна зберігати елементи будь-якого типу.
  - **Швидкий доступ за індексом**: О(1) для доступу до елементу.
  - **Динамічний розмір**: Список автоматично змінює розмір при додаванні елементів.

**7. Недоліки списків**

  - **Повільна вставка/видалення в середині:** О(n) через необхідність зсуву елементів.
  - **Використання пам'яті**: Список використовує додаткову пам'ять для динамічного змінення розміру. 

***8. Внутрішня реалізація (CPython)***

У реалізації CPython список представлений як структура на C:

```c
typedef struct {
  PyObject_VAR_HEAD
  PyObject **ob_item; // Масив посилань на об'єкти 
  Py_ssize_t allocated; // Кількість виділеної пам'яті 
} PyListObject;
```
 - **`ob_item`**: Масив посилань на об'єкти.
 - `allocated`: Кількість виділеної пам'яті (може бути більшою за фактичну кількість елементів).

***9. Приклад роботи зі списком***

```python 
# Створення списку 
lst = [1, 2, 3]

# Додавання елемента 
lst.append(4) # [1, 2, 3, 4]

# Вставка елемента 
lst.insert(1, 1.5) # [1, 1.5, 2, 3, 4]

# Видалення елемента
lst.pop(2) # [1, 1.5, 3, 4]

# Зріз 
new_lst = lst[1:3] # [1.5, 3]
```


***Висновок***

 - Список у Python - це **динамічний масив посилань на об'єкти**.
 - Він ефективно використовує пам'ять за рахунок динамічного змінення розміру.
 - Основні операції (доступ за індексом, додавання в кінець) мають складність О(1).
 - Вставка та видалення в середені списку мають складність О(n).

