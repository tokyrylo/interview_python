# Set 

**Множина (set)** - це **змінюваний (mutable), неупорядкований** тип даних, який зберігає **унікальні** елементи. Елементи множини можуть бути будь-якого типу, але вони повинні бути **хешованими** (наприклад, числа, рядки, кортежі). Множина не підтримує індексацію, оскільки елементи не мають  порядку. 

Приклад:

```python 
my_set = {1, 2, 3, "hello"}
```

***Як множина працює під капотом?***

1. **Внутрішня організація?**

Множина у Python реалізована як **хеш-таблиця (hash table)**. Це означає:

  - Кожен елемент множини хешується за допомогою хеш-функції, і за значенням хешу визначається позиція в таблиці.
  - Хеш-таблиця дозволяє швидко перевіряти наявність елемента (в середньому О(1)).

**2. Використання пам'яті?**

  - **Хеш-таблиця**: Множина зберігає елементи в хеш-таблиці, яка складається з "комірок" (slots). Кожна комірка містить хеш елемента та сам елемент.
  - **Колізії**: Якщо два елемента мають однаковий хеш, виникає колізія. Python вирішує колізії за допомогою **відкритої адресації** (open addressing) та **методу лінійного зондування** (linear probing)/
  - **Динамічне змінення розміру**: Якщо хеш-таблиця заповнюється, Python автоматично збільшує її розмір і перехешує все елементи.

**3. Операції з множинами та їх складність**

Ось основні операції з множинами та їх часова складність (Big-O).

| Операція | Складність | Опис |
| --------------- | --------------- | --------------- |
| Додавання елементів (`add`) | O(1) | Додавання нового елемента в множину. |
| Видалення елемента (`remove`) | O(1) | Видалення елемента з множини |
| Перевірка наявності (`x in s`) | O(1) | Перевірка, чи існує елемент у множині. |
| Об'єднання (`union`) | O(n+m) | Створення нової множини, яка містить спільні елементи двох множин. |
| Перетин (`intersection`) | O(min(n, m)) | Створення нової множини, яка містить спільні елементи двох множин. |
| Різниця (`defference`) | O(n) | Створення нової множини, яка містить елементи першої множини, відсутні в другій. |
| Симетрична різниця (`symmetric_difference`) | O(n) | Створення нової множини, яка містить елементи, що є в одній множині, але не в обох |

***4. Хешування елементів***

  - Елементи множини повинні бути **хешованими**. Це означає, що вони повинні мати метод `__hash__()`, який повертає унікальне ціле число.
  - Незмінювані типи (наприклад, числа, рядки, кортежі) є хешованими, а змінювані типи (наприклад, списки, словники) - ні.

  Приклад:

  ```python 
  hash("hello") # Повертає хеш рядка "hello"
  ```

***5. Колізії та їх вирішення***

Колізія виникає, коли два елементи мають однаковий хеш. Python вирішує колізії за допомогою:

  - **Відкритої адресації**: Якщо комірка зайнята, Python шукає наступну вільну комірку.
  - **Лінійного зондування**: Python перевіряє комірки по черзі, доки не знайде вільну.

***6. Динамічне змінення розміру (Resizing)***

Коли хеш-таблиця заповнюється, Python автоматично збільшує її розмір. Це відбувається за таким алгоримом:

  1. Виділяється новий, більший блок пам'яті.
  2. Всі елементи перехешуються, і вони копіюються в нову таблицю.
  3. Стара таблиця звільняється.

***7. Приклад роботи з пам'яттю***

Розглянемо приклад:

```python 
my_set = set() # Створюється пуста множина 

for i in range(10):
  my_set.add(i) # Додаємо нові елементи 
```
  - Спочатку множина виділяє пам'ять для кількох комірок (наприклад, 8).
  - Коли таблиця заповнюється, Python виділяє новий блок пам'яті (наприклад, на 16 комірок) і копіює туди старі елементи.
  - Цей процес повторюється, коли таблиця знову заповнюється.

***8. Переваги множин***

  - **Швидкий доступ до елементів**: О(1) в середньому для додавання, видалення та перевірки наявності.
  - **Унікальність елементів**: Множина автоматично видаляє дублікати.
  - **Ефективність для операції з множинами**: Об'єднання, перетин, різниця та симетрична різниця працюють швидко.

**9. Недоліки множин**

  - **Використання пам'яті**:  Множина використовує додаткову пам'ять для хеш-таблиці.
  - **Невпорядкованість**: Елементи множини не мають порядку, тому доступ за індексом неможливий.

***10. Внутрішня реалізації (CPython)***

У реалізації CPython множина представлена як структура на С:

```c 
typedef struct {
  PyObject_HEAD 
  Py_ssize_t ma_user; // Кількість використаних комірок
  PyDictKeyObject *ma_keys; // Ключі (елементи множини)
} PySetObject; 
```
  - `ma_used`: Кількість використаних комірок.
  - `ma_keys`: Масив ключів (елементів множини).

***11. Приклад роботи з множиною***

```python 
# Створення множини 
my_set = {1, 2, 3}

# Додавання елемета 
my_set.add(4) # {1, 2, 3, 4}

# Видалення елемента
my_set.remove(2) # {1, 3, 4}

# Перевірка наявності елемента 
print(3 in my_set) # True 

# Об'єднання множин 
new_set = my_set.union({4, 5, 6}) # {1, 3, 4, 5, 6}

# Перетин множин 
intersection_set = my_set.intersection({3, 4, 5}) # {3, 4}
```
***Висновок***

- Множина у Python - це **хеш-таблиця**, яка зберігає унікальні елементи.
- Вона ефективно використовує пам'ять за рахунок динамічного змінення розміру.
- Основні операції (додавання, видалення, перевірка наявності) мають складність О(1) в середньому.
- Колізії вирішуються за допомогою відкритої адресації та лінійного зондування.



