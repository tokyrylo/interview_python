# Dict 

***1. Що таке словник (dict)***

Словник у Python - це **змінюваний (mutable)**, **неупорядкований** тип даних, який зберігає пари **ключ-значення**. Ключи в словнику повинні бути унікальними та незмінюваними (наприклад, числа, рядки або кортежі), а значення можуть бути будь-якого типу.

Приклад:

```python 
my_dict = {"name": "Alice", "age": 25, "city": "New York"}
```

***2. Як словник працює "під капотом"?***

  **1. Внутрішня організація**
  
  Словник у Python реалізований як **хеш-таблиця (hash table)**. Це означає:

  - Кожен ключ хешується за допомогою хеш-функції, і за значення хешу визначається позиція в таблиці, де зберігається відповідне значення.
  - Хеш-таблиця дозволяє швидко знаходити значення за ключем (в середену О(1)).

  **2. Використання пам'яті**

  - **Хеш-таблиця**: Словник зберігає ключі та значення в хеш-таблиці, яка складається з "комірок" (**slots**). Кожна комірка містить хеш ключа, ключ і значення.
  - **Колізії**: Якщо два ключі мають однаковий хеш, виникає колізія. Python вирішує колізії за допомогою **відкритої адресації** (open addressing) та **методу лінійного зондування** (linear probing).
  - **Динамічне змінення розміру**: Якщо хеш-таблиця заповнюється, Python автоматично збільшує її розмір і перехешує всі ключі.

  **3. Операції зі словниками та їх складність**

  Основні операції зі словниками та їх часова складність (Big-O).

  | Операція | Складність | Опис |
  | --------------- | --------------- | --------------- |
  | Додавання пари ключ-значення | О(1) | Додавання нового ключа та значення в словник. |
  | Отримання значення за ключем | О(1) | Швидкий доступ до значення за ключем. |
  | Видалення пари ключ-значення | О(1) | Видалення ключа та значення у словнику. |
  | Перевірка наявності ключа | О(1) | Перевірка, чи існує ключ у словнику. |
  | Ітерація по ключах або значеннях | О(1) | Перебір всіх ключів або значень у словнику. | 
 
  ***4. Хешування ключів***

   - Ключі в словнику повинні буи **хешованими**. Це означає, що вони повинні мати метод `__hash__()`, який повертає унікальне ціле число.
   - Незмінюванні типи (наприклад, числа, рядки, кортежі) є хешованими, а змінювані типи (наприклад, списки, словники) - ні.

   Приклад:
    
   ```python 
  hash("hello") # Повертає хеш рядка "hello"
  ```
  ***5. Колізії та їх вирішення***

  Колізія виникає, коли два ключі мають однаковий хеш. Python вирішує колізії за допомогою:
  
  - **Відкритої адресації:** Якщо комірка зайнята, Python шукає наступну вільну комірку.
  - **Лінійного зондування:** Python перевіряє комірки по черзі, доки не знайде вільну.

  ***6. Динамічне змінення розміру (Resizing)***
  
  Коли хеш-таблиця заповнюється, Python атоматично збільшує її розмір. Це відбувається за таким алгоритмом:

  1. Виділяється новий, більший блок пам'яті.
  2. Всі ключі перехишуються, і пари ключ-значення копіюються в нову таблицю. 
  3. Стара таблиця звільняється.

  ***7. Приклад роботи з пам'яттю***

  Розглянемо приклад:

  ```python 
    my_dict = {} # Сворюється пустий словник 
    for i in range(10):
      my_dict[i] = i * 2 # Додаємо пари ключ-значення 
  ```

  - Спочатку словник віділяє пам'ять для кількох комірок (наприклад, 8).
  - Коли таблиця заповнюється, Python виділяє новий блок пам'яті (наприклад, на 16 комірок) і копіює туди старі пари ключ-значення.
  - Цей процес повторюється, коли таблиця знову заповнюється.

  ***8. Переваги словників***

  - **Швидкий доступ до значень**: О(1) в середньому для доступу, додавання та видалення.
  - **Гнучкість**: ключі та  значення можуть бути будь-яких типів (ключі повинні бути хешованими).
  - **Ефективне використання пам'яті**: Хеш-таблиця дозволяє ефективно зберігати дані. 

  ***9. Недоліки словників***

  - **Використання пам'яті**: Словник використовує додаткову пам'ять для хеш-таблиці.
  - **Невпорядкованість**: до версії 3.7 словники не гарантували збереження порядку додавання елементів, у 3.7 порядок зберігається.

  **10. Внутрішня реалізація CPython**:
  
  У реалізації CPython словник представлений як структура на С:

  ```c 
  type_of struct {
    PyObject_HEAD 
    Py_ssize_t ma_used; // кількість використаних комірок
    PyDictKeyObject *ma_keys; // Ключі
    PyObject **ma_values; // Значення 
  } PyDictObject; 
  ```
  - `ma_used`: Кількість використаних комірок.
  - `ma_keys`: Масив ключів.
  - `ma_values`: Масив значень.

  ***11. Приклад робои зі словником***

  ```python 
  # Створення словника 
  my_dict = {"name": "Alice", "age": 25}

  # Додавання пари ключ-значення
  my_dict["city"] = "New York" # {"name": "Alice", "age": 25, "cuty": "New York"}

  # Отримання значення за ключем
  print(my_dict["name"]) # Alice 

  # Видалення пари ключ-значення 
  del my_dict["age"] # {"name": "Alice", "city": "New York"}

  # Перевірка наявності ключа 
  print("name" in my_dict) # True
```

***Висновок***

 - Словник Python - це **хеш-таблиця**, яка зберігає пари ключ-значення.
 - Він ефективно використовує пам'ять за рахунок динамічного змінення роміру.
 - Основні операції (доступ, додавання, видалення) мають складність О(1) в середньому.
 - Колізії вирішуються за допомогою відкритої адресації та лінійного зондування.
