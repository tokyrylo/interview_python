# Frozenset 

**`frozenset`** - це **незмінюваний (immutable)** аналог звичайної множини (`set`). Вона зберігає **унікальні** елементи, які можуть бути будь-якого хешуваного типу (наприклад, числа, рядки, кортежі). На відміну від звичайної множини, `frozenset` не можна змінювати після створення.

Приклад:

```python 
my_frozenset = frozenset([1, 2, 3, "hello"])
```

***Як frozenset працює "під капотом"?***

1. **Внутрішня організація**
`frozenset` реалізована так само, як і звичайна множина (`set`), - за допомогою **хеш-таблиці (hash table)**.

  - Кожен елемент хешується за допомогою хеш-функції, і за значенням хешу визначається позиція в таблиці.
  - Хеш-таблиця дозволяє швидко перевіряти наявність елемента (в середньому О(1)).

2. **Використання пам'яті**

  - **Хеш-таблиця**: `frozenset` зберігає елементи в хеш-таблиці, яка складається з "комірок" (slots). Кожна комірка містить хеш елемента та сам елемент.
  - **Фіксований розмір**: Оскільки `frozenset` є незмінюваним, її розмір фіксований після створення. Це дозволяє Python оптимізувати використання пам'яті.
  - **Ефективнісь**: `frozenset` використовує менше пам'яті, ніж звичайна множина, оскільки не потребує додаткової пам'яті для динамічного змінення розміру.

3. **Операції з frozenset та їх складність**

Ось основні операції з `frozenset` та їх часова складність (Big-O)

| Операція | Складність | Опис |
| --------------- | --------------- | --------------- |
| Перевірка наявності (`x in fs`) | O(1) | Перевірка, чи існує елемент у `frozenset` |
| Об'єднання (`union`) | O(n+m) | Створення нової множини, яка містить всі елементи двох множин |
| Перетин (`intersection`) | O(min(n, m)) | Створення нової множини, яка містить спільні елементи двох множин. |
| Різниця (`difference`) | O(n) | Створення нової множини, яка містить елементи першої множини, відсутні в другій. |
| Симетрична різниця (`symmetric_difference`) | O(n) | Створення нової множини, яка містить елементи що є в одній множині, але не в обох. |

4. **Хешування елементів**

  - Елементи `frozenset` повинні бути **хешованими**. Це означає, що вони повинні мати метод `__hash__()`, який повертає унікальне ціле число.
  - Незмінювані типи (наприклад, числа, рядки, кортежі) є хешованими, а змінювані типи (наприклад, списки, словники) - ні. 

  Приклад:
  ```python 
  hash("hello") # Повертає хеш рядка "hello"
  ```

5. **Колізії та їх вирішення**

Колізія виникає, коли два елементи мають однаковий хеш. Python вирішує колізії за допомогою:

  - **Відкритої адресації**: Якщо комірка зайнята, Python шукає наступну вільну комірку.
  - **Лінійного зондування**: Python перевіряє комірки по черзі, доки не знайде вільну.

6. **Незмінюваність (Immutability)**

  - `frozenset` є незмінюваним, тому після створення її елементи не можна змінювати, додавати або видаляти.
  - це робить `frozenset` безпечною для використання в якості ключів у словниках або елементів інших множин.

  Приклад:

  ```python 
  my_frozenset = frozenset([1, 2, 3])
  my_frozenset.add(4) # Помилка: 'frozenset' object has no attribute 'add'
```
7. **Переваги frozenset**

  - **Єфективність**: `frozenset` зазвичай швидша за звичайну множину, оскільки вона не потребує динамічного змінення розміру.
  - **Незмінюваність**: `frozenset` є безпечною для використання в якості ключів у словниках або елементів інших множин.
  - **Менше використання пам'яті**: `frozenset` використовує менше пам'яті, ніж звичайна множина.

8. **Недоліки frozenset**

  - **Незмінюваність**: Неможливість змінити елементи після створення може бути обмеженням у деяких сценаріях.
  - **Обмежена функціональність**: `frozenset` має менше методів порівняно зі звичайною множиною.

9. **Внутрішня реалізація (CPython)**

У реалізації CPython `frozenset` представлена як структура на С:

```c 
typedef struct {
  PyObject_HEAD
  Py_ssize_t ma_used; // Кількість використаних комірок
  PyDictKeyObject *ma_keys; // Ключі (елементи множини)
} PyFrozenSetObject;
```
- `ma_used`: Кількість використаних комірок.
- `ma_kyes`: Масив ключів (елементів множини).


10. **Приклад роботи з frozenset**

```python 
# Створення frozenset
my_frozenset = frozenset([1, 2, 3])

# Перевірка наявності елемента 
print(2 in my_frozenset) # True 

# Об'єднання з іншою множиною
new_frozenset = my_frozenset.union({4, 5, 6}) # frozenset({1, 2, 3, 4, 5, 6})

# Перетин з іншою множиною 
intersection_frozenset = my_frozenset.intersection({3, 4, 5}) # frozenset({3})

# Використання як ключ 
my_dict = {my_frozenset: "value"}
print(my_dict) # {frozenset({1, 2, 3}): "value"}
```

***Висновок***

- `frozenset` у Python - це **незмінюваний** аналог звичайної множини.
- Вона зберігає унікальні елементи в хеш-таблиці.
- Основні операції (перевірка наявності, об'єднання, перетин) мають складність О(1) в середньому.
- `frozenset` є безпечною для використання в якості ключів у словниках або елементів інших множин.
